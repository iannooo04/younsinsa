enum Gender {
  MEN
  WOMEN
  UNISEX
}

model Brand {
  id          String    @id @default(cuid())
  name        String    @unique
  slug        String?   @unique
  category    String? // Main category name for filtering
  logoUrl     String?
  description String?
  parentId    String?
  parent      Brand?    @relation("BrandToBrand", fields: [parentId], references: [id])
  children    Brand[]   @relation("BrandToBrand")
  products    Product[]
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model Category {
  id        String     @id @default(cuid())
  name      String
  code      String?    @unique // e.g., "104002"
  slug      String?    // e.g., "sneakers"
  imageUrl  String?

  parentId  String?
  parent    Category?  @relation("SubCategories", fields: [parentId], references: [id])
  children  Category[] @relation("SubCategories")
  products  Product[]
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt

  @@index([slug])
}

model Product {
  id            String   @id @default(cuid())
  name          String
  description   String?
  detailContent String?
  price         Int
  originalPrice Int      @default(0)
  discount      Int      @default(0)
  gender        Gender   @default(UNISEX)
  isLimited     Boolean  @default(false)
  tags          String[]

  supplyPrice   Int      @default(0)
  videoUrl      String?
  
  // Shipping
  shippingFee      Int      @default(0)
  shippingMethod   String?
  shippingDuration String?

  // Legal / Notices
  material      String?
  origin        String?
  manufacturer  String?
  washCare      String?
  asInfo        String?

  brandId       String
  brand         Brand    @relation(fields: [brandId], references: [id])
  
  categoryId    String
  category      Category @relation(fields: [categoryId], references: [id])

  images        ProductImage[]
  options       ProductOption[]
  variants      ProductVariant[]
  wishlistedBy  WishlistItem[]
  reviews       ProductReview[]
  cartItems     CartItem[]
  orderItems    OrderItem[]

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([brandId])
  @@index([categoryId])
  @@index([gender])
}

model ProductImage {
  id        String   @id @default(cuid())
  productId String
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  url       String
  order     Int      @default(0)
  createdAt DateTime @default(now())
}

model ProductOption {
  id        String               @id @default(cuid())
  productId String
  product   Product              @relation(fields: [productId], references: [id], onDelete: Cascade)
  name      String               // e.g., "Color", "Size"
  values    ProductOptionValue[]
}

model ProductOptionValue {
  id       String        @id @default(cuid())
  optionId String
  option   ProductOption @relation(fields: [optionId], references: [id], onDelete: Cascade)
  name     String        // e.g., "Red", "XL"
}

model ProductVariant {
  id             String   @id @default(cuid())
  productId      String
  product        Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  sku            String?  @unique
  price          Int?     // Optional price override
  stock          Int      @default(0)
  optionValueIds String[] // Array of ProductOptionValue IDs
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@index([productId])
}

model WishlistItem {
  id        String   @id @default(cuid())
  userId    String
  user      UserInfo @relation(fields: [userId], references: [id], onDelete: Cascade)
  productId String
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())

  @@unique([userId, productId])
}

model ProductReview {
  id        String   @id @default(cuid())
  productId String
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  userId    String
  user      UserInfo @relation(fields: [userId], references: [id], onDelete: Cascade)
  rating    Int      @default(5)
  comment   String?
  images    String[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([productId])
  @@index([userId])
}

model OptionTemplate {
  id        String   @id @default(cuid())
  name      String   @unique
  options   Json     // Stores array of { name: string, values: string[] }
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
