// ----------------------------------------------------------------------
// 게시판 관리 (Board Management)
// ----------------------------------------------------------------------

enum BoardType {
  BASIC     // 일반형
  GALLERY   // 갤러리형
  EVENT     // 이벤트형
  INQUIRY   // 1:1 문의형
}

enum BoardAccess {
  ALL       // 전체(회원+비회원)
  MEMBER    // 회원전용
  ADMIN     // 관리자전용
  GRADE     // 특정등급이상
}

enum AuthorDisplay {
  NAME
  NICKNAME
  ID
}

model Board {
  id             String      @id @default(cuid())
  boardId        String      @unique // 게시판 아이디 (e.g. "notice")
  name           String      // 게시판명
  
  type           BoardType   @default(BASIC)
  
  // -- 사용 설정 --
  usePcMall      Boolean     @default(true)
  useMobileMall  Boolean     @default(true)
  
  // -- 권한 설정 --
  listAccess     BoardAccess @default(ALL)
  readAccess     BoardAccess @default(ALL)
  writeAccess    BoardAccess @default(ALL)
  replyAccess    BoardAccess @default(ADMIN)
  commentAccess  BoardAccess @default(MEMBER)
  
  minGradeId     String?     // 특정 등급 이상일 경우
  
  // -- 기능 설정 --
  useReply       Boolean     @default(true)
  useComment     Boolean     @default(true)
  useSecret      Boolean     @default(false) // 비밀글 사용
  useProductLink Boolean     @default(false) // 상품 연동
  useOrderLink   Boolean     @default(false) // 주문 연동
  useFile        Boolean     @default(true)
  maxFileSize    Int         @default(10) // MB
  
  // -- 표시 설정 --
  authorDisplay  AuthorDisplay @default(NICKNAME)
  
  // -- 스킨 연결 --
  skinPcId       String?
  skinMobileId   String?
  
  // -- Relation --
  posts          Post[]
  categories     BoardCategory[] // 말머리(Category)
  
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt
  
  // -- SEO --
  seoTitle       String?
  seoAuthor      String?
  seoDescription String?
  seoKeywords    String?

  // -- List/View Settings --
  itemsPerPage   Int         @default(15)
  subjectLimit   Int         @default(30)
  showNotice     Boolean     @default(true) 
  
  // -- Editor/Write Settings --
  useEditor      Boolean     @default(true)
  
  // -- Design --
  headerHtml     String?     @db.Text
  footerHtml     String?     @db.Text

  @@map("board")
}

model BoardCategory {
  id        String @id @default(cuid())
  boardId   String
  board     Board  @relation(fields: [boardId], references: [id], onDelete: Cascade)
  
  name      String // 말머리 명
  
  posts     Post[]

  @@map("board_category")
}

model Post {
  id             String      @id @default(cuid())
  
  boardId        String
  board          Board       @relation(fields: [boardId], references: [id], onDelete: Cascade)
  
  categoryId     String?
  category       BoardCategory? @relation(fields: [categoryId], references: [id])
  
  // -- 작성자 --
  authorId       String?     // 회원일 경우
  author         UserInfo?   @relation("PostAuthor", fields: [authorId], references: [id]) 
  
  authorName     String?     // 비회원/관리자일 경우 직접 입력
  password       String?     // 비회원 글 비밀번호
  ipAddress      String?
  
  // -- 내용 --
  subject        String
  content        String      @db.Text
  isHtml         Boolean     @default(true)
  
  isSecret       Boolean     @default(false)
  isNotice       Boolean     @default(false) // 공지사항
  
  // -- 연동 --
  productId      String?
  product        Product?    @relation(fields: [productId], references: [id])
  
  // -- 상태 --
  views          Int         @default(0)
  
  // -- 답변 (Hierarchical) --
  parentId       String?     // 답글일 경우 원글 ID
  parent         Post?       @relation("PostReplies", fields: [parentId], references: [id])
  replies        Post[]      @relation("PostReplies")
  
  depth          Int         @default(0)
  
  // 답변 상태 (1:1 문의 등에서 사용)
  answerStatus   String?     // WAITING, COMPLETE 등
  
  comments       Comment[]
  attachments    Attachment[]
  
  // Legacy support for SupportAssignment
  assignment     SupportAssignment?
  
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt
  
  @@index([boardId])
  @@index([authorId])
  @@map("post")
}

model Comment {
  id             String      @id @default(cuid())
  
  postId         String
  post           Post        @relation(fields: [postId], references: [id], onDelete: Cascade)
  
  authorId       String?
  author         UserInfo?   @relation("CommentAuthor", fields: [authorId], references: [id])
  
  authorName     String?
  password       String?
  ipAddress      String?
  
  content        String      @db.Text
  isSecret       Boolean     @default(false)
  
  // 대댓글 지원 가능
  parentId       String?
  parent         Comment?    @relation("CommentReplies", fields: [parentId], references: [id])
  children       Comment[]   @relation("CommentReplies")
  
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt

  @@map("comment")
}

model Attachment {
  id        String   @id @default(cuid())
  postId    String
  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  fileUrl   String
  fileName  String
  fileSize  Int
  createdAt DateTime @default(now())

  @@index([postId])
  @@map("attachment")
}

// ----------------------------------------------------------------------
// FAQ
// ----------------------------------------------------------------------

model Faq {
  id        String   @id @default(cuid())
  
  mallId    String   @default("KR")
  category  String   // e.g. 배송, 반품/교환
  
  question  String
  answer    String   @db.Text
  
  isBest    Boolean  @default(false)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("faq")
}

// ----------------------------------------------------------------------
// 금칙어 (Banned Words)
// ----------------------------------------------------------------------

model BannedWord {
  id        String   @id @default(cuid())
  word      String   @unique
  
  createdAt DateTime @default(now())

  @@map("banned_word")
}

// ----------------------------------------------------------------------
// 게시판 스킨 (Board Skin)
// ----------------------------------------------------------------------

model BoardSkin {
  id        String   @id @default(cuid())
  code      String   @unique
  name      String
  
  platform  String   // PC, MOBILE
  designSkin String  // e.g. glance
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("board_skin")
}

// Legacy Support Assignment (Refactored to map to new Post)
model SupportAssignment {
  postId String @id
  post   Post   @relation(fields: [postId], references: [id], onDelete: Cascade)

  assigneeId String?
  assignee   UserInfo? @relation(name: "TicketAssignee", fields: [assigneeId], references: [id], onDelete: SetNull)

  assignedAt DateTime @default(now())

  @@index([assigneeId])
  @@map("support_assignment")
}

