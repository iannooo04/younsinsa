// prisma/schema/BasicPolicy.prisma

// 기본정책 (Basic Policy) 통합 모델
// 여러 설정들을 그룹화하기 위한 상위 모델입니다. (싱글톤으로 사용 예상)
model BasicPolicy {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // 1. 부가세율 설정
  vatSettings   VatSettings?

  // 2. 이용/탈퇴 안내
  guideSettings GuideSettings?

  // 3. 금액/단위 기준 설정
  currencySettings CurrencySettings?

  // 4. 저장소 경로 일괄 관리
  storageSettings StorageSettings?

  // 5. 검색엔진 최적화(SEO) 설정
  seoSettings SeoSettings?

  // 6. 환율 설정
  exchangeRateSettings ExchangeRateSettings?

  // 7. 해외 배송조건 관리
  overseasShippingSettings OverseasShippingSettings?

  // 8. 상품 기본 설정
  productBasicSettings ProductBasicSettings?

  // 9. 상품 이미지 사이즈 설정
  productImageSizeSettings ProductImageSizeSettings?

  // 10. 상품 상세 이용안내 설정
  productUsageGuideSettings ProductUsageGuideSettings?

  // 11. 최근 본 상품 설정
  recentProductsSettings RecentProductsSettings?

  // 12. 휴대폰인증 설정
  mobileAuthSettings MobileAuthSettings?

  // 13. 주문 기본 설정
  orderBasicSettings OrderBasicSettings?

  // 14. 주문 상태 설정
  orderStatusSettings OrderStatusSettings?

  // 15. 주문서 인쇄 설정
  orderPrintSettings OrderPrintSettings?

  // 16. 장바구니/관심상품 설정
  cartWishlistSettings CartWishlistSettings?

  // 17. 구글 로그인 설정
  googleLoginSettings GoogleLoginSettings?

  // 18. 상품 상세 노출항목 설정
  productDetailExposureSettings ProductDetailExposureSettings?

  // 19. 회원 가입 정책
  memberJoinPolicy MemberJoinPolicy?

  // 20. 회원 가입 항목 설정
  memberJoinItemSettings MemberJoinItemSettings?

  // 21. 회원 등급 설정
  memberGradeSettings MemberGradeSettings?

  // 22. 쇼핑몰/회사 기본 정보
  basicInfoSettings BasicInfoSettings?

  // 23. 해외 상점 설정
  globalShopSettings GlobalShopSettings?

  // 24. 주문서 추가정보 설정
  orderAdditionalInfoSettings OrderAdditionalInfoSettings?
}


// ... existing models ...

// 20. 회원 가입 항목 설정 (Member Join Item Settings)
model MemberJoinItemSettings {
  id            Int         @id @default(autoincrement())
  basicPolicyId Int         @unique
  basicPolicy   BasicPolicy @relation(fields: [basicPolicyId], references: [id])

  // 가입 항목 설정 (JSON)
  // {
  //   "memberType": { "personal": true, "business": false },
  //   "items": { ... },
  //   "customItems": [ ... ],
  //   "captcha": { "use": false }
  // }
  schema        Json
}

// ... existing models ...

// 16. 장바구니/관심상품 설정 (Cart/Wishlist Settings)
model CartWishlistSettings {
  id              Int         @id @default(autoincrement())

  basicPolicyId   Int         @unique
  basicPolicy     BasicPolicy @relation(fields: [basicPolicyId], references: [id])

  // --- 장바구니 설정 ---
  
  // 상품보관기간
  // period (일수 설정), forever (영구 보관)
  cartStoragePeriodType String @default("period")
  cartStorageDays       Int    @default(7)

  // 보관상품 개수제한
  // limit (개수 설정), unlimited (무제한)
  cartItemLimitType     String @default("limit")
  cartItemLimitCount    Int    @default(20)

  // 같은 상품을 담을 경우
  // increase (수량 증가), no-change (변화 없음)
  cartSameProduct       String @default("increase")

  // 가격이 0원인 상품
  // allow (담음), deny (담지 않음)
  cartZeroPrice         String @default("allow")

  // 품절상품 보관설정
  // keep (유지), delete (삭제)
  cartSoldOut           String @default("keep")

  // 장바구니 보관시 페이지 이동방법
  // direct (바로 이동), popup (확인 팝업)
  cartMovePageType      String @default("direct")
  // 팝업 설정 시 타겟 (pc, mobile) - UI상 select box가 있음
  cartMovePageTarget    String @default("pc")

  // 바로구매 설정
  // only-current (해당 상품만), with-cart (기존 장바구니 포함)
  cartDirectBuy         String @default("only-current")

  // --- 관심상품 설정 ---

  // 상품개수 제한
  // limit, unlimited
  wishItemLimitType     String @default("limit")
  wishItemLimitCount    Int    @default(20)

  // 장바구니로 상품이동시
  // keep (남김), delete (삭제)
  wishMoveToCart        String @default("delete")

  // 품절상품 보관설정
  // keep, delete
  wishSoldOut           String @default("keep")

  // 관심상품 보관시 페이지 이동방법
  // direct, popup
  wishMovePageType      String @default("direct")
  wishMovePageTarget    String @default("pc")
}

// ... existing models ...

// 15. 주문서 인쇄 설정 (Order Print Settings)
model OrderPrintSettings {
  id              Int         @id @default(autoincrement())

  basicPolicyId   Int         @unique
  basicPolicy     BasicPolicy @relation(fields: [basicPolicyId], references: [id])

  // 거래명세서 출력 설정
  applyMallTrans      Boolean @default(true)
  qtyTotalUsed        Boolean @default(false)
  prodCodeTrans       Boolean @default(false)
  ownCodeTrans        Boolean @default(false)
  
  // 합계 금액 포함 여부
  includeShippingFee  Boolean @default(true)
  includeDiscount     Boolean @default(true)
  includeMileage      Boolean @default(false)
  includeDeposit      Boolean @default(false)

  bizMemberUsed       Boolean @default(false)
  footerInfoTransUsed Boolean @default(false)

  // 주문내역서 출력 설정
  applyMallOrder      Boolean @default(true)
  prodCodeOrder       Boolean @default(false)
  ownCodeOrder        Boolean @default(false)
  
  supplierDisplay     String  @default("display") // display, no-display
  imgDisplay          String  @default("display") // display, no-display
  payDisplay          String  @default("display") // display, no-display
  memoDisplay         String  @default("no-display") // display, no-display
  
  footerInfoOrderUsed Boolean @default(false)
  footerInfoOrderText String? @db.Text
}

// ... existing models ...

// 13. 주문 기본 설정 (Order Basic Settings)
model OrderBasicSettings {
  id            Int         @id @default(autoincrement())
  basicPolicyId Int         @unique
  basicPolicy   BasicPolicy @relation(fields: [basicPolicyId], references: [id])

  // 결제페이지 청약의사 재확인 설정 (used, unused)
  confirmCheck             String @default("used")

  // 자동배송완료 설정 (used, unused)
  autoDeliveryComplete     String @default("unused")
  autoDeliveryCompleteDays Int    @default(7)

  // 자동구매확정 설정 (used, unused)
  autoPurchaseConfirmation     String @default("unused")
  autoPurchaseConfirmationDays Int    @default(7)

  // 환불 진행 재확인 사용설정 (used, unused)
  refundReconfirm          String @default("unused")

  // 고객 교환/반품/환불 신청기능 사용설정 (used, unused)
  customerClaimRequest     String @default("unused")

  // 클레임 처리 기본 노출 설정 (JSON)
  // {
  //   "cancel": { "stockRestore": "restore", "couponRestore": "norestore", "giftProvide": "provide" },
  //   "exchange": { "couponRestore": "norestore", "giftProvide": "provide", "mileageProvide": "provide", "couponMileageProvide": "provide" },
  //   "refund": { "stockRestore": "norestore", "couponRestore": "norestore" }
  // }
  claimSettings Json
}

// 14. 주문 상태 설정 (Order Status Settings)
model OrderStatusSettings {
  id              Int         @id @default(autoincrement())
  
  basicPolicyId   Int         @unique
  basicPolicy     BasicPolicy @relation(fields: [basicPolicyId], references: [id])

  // 자동 취소 설정 (일수)
  autoCancelDays  Int         @default(3)

  // 상태별 설정 (JSON) - 각 상태코드별 이름, 사용여부, 로직 등을 저장
  statusSettings  Json?

  // 혜택/재고 지급/차감 시점 설정 (JSON)
  benefitSettings Json?
}


// 12. 휴대폰인증 설정 (Mobile Authentication Settings)
model MobileAuthSettings {
  id            Int         @id @default(autoincrement())
  basicPolicyId Int         @unique
  basicPolicy   BasicPolicy @relation(fields: [basicPolicyId], references: [id])

  // 인증 서비스 제공사 (kcp, dream)
  provider      String @default("kcp")

  // 사용 설정 (used, unused)
  usage         String @default("unused")

  // 회원사 CODE (API 등에서 받아온다고 가정, 여기서는 텍스트 저장)
  partnerCode   String?
}


// 11. 최근 본 상품 설정 (Recently Viewed Products Settings)
model RecentProductsSettings {
  id            Int         @id @default(autoincrement())
  basicPolicyId Int         @unique
  basicPolicy   BasicPolicy @relation(fields: [basicPolicyId], references: [id])

  // 시간 설정 (시간)
  expirationHours Int @default(24)

  // 최대 수량 (개)
  maxCount        Int @default(10)
}

// 10. 상품 상세 이용안내 설정 (Product Usage Guide Settings)
model ProductUsageGuideSettings {
  id            Int         @id @default(autoincrement())
  basicPolicyId Int         @unique
  basicPolicy   BasicPolicy @relation(fields: [basicPolicyId], references: [id])

  // 이용안내 목록 (JSON List)
  // [ { "id": "uuid", "code": "...", "type": "delivery", "title": "...", "supplier": "hq", "regDate": "..." } ]
  guides Json
}

// 8. 상품 기본 설정 (Product Basic Settings)
model ProductBasicSettings {
  id            Int         @id @default(autoincrement())
  basicPolicyId Int         @unique
  basicPolicy   BasicPolicy @relation(fields: [basicPolicyId], references: [id])

  // 상품수정일 변경 범위 설정 (JSON)
  // { "productEdit": true, "productList": true, ... }
  modDateRange Json

  // 상품수정일 변경 확인 팝업 (used, unused)
  modDatePopup  String @default("unused")

  // 이미지 로딩 향상 (used, unused)
  imageLoadingEnhance String @default("unused")

  // 가격정보 노출여부 (exposed, hidden)
  priceExposure String @default("exposed")

  // 옵션가 표시설정 (exposed, hidden)
  optionPriceExposure String @default("exposed")

  // 하위브랜드 상품진열 설정 (sold, unsold)
  subBrandProductDisplay String @default("unsold")

  // 상위카테고리 자동등록 설정 (used, unused)
  parentCategoryAutoRegister String @default("unused")

  // 네비게이션 영역 설정 (used, unused)
  navCategoryUsage String @default("used")
  navBrandUsage    String @default("used")

  // 상품수 노출여부 설정 (used, unused)
  countCategoryUsage String @default("used")
  countBrandUsage    String @default("used")
}

// 9. 상품 이미지 사이즈 설정 (Product Image Size Settings)
model ProductImageSizeSettings {
  id            Int         @id @default(autoincrement())
  basicPolicyId Int         @unique
  basicPolicy   BasicPolicy @relation(fields: [basicPolicyId], references: [id])

  // 설정 방법 선택 (ratio, fixed)
  resizeMethod String @default("ratio")

  // 기본 이미지 사이즈 (JSON)
  // { "zoom": { "width": 600 }, "detail": { "width": 600 }, "thumb": { "width": 150 } }
  basicImages Json

  // 리스트 이미지 사이즈 (JSON Array)
  // [ { "id": "uuid", "name": "리스트 이미지(기본)", "width": 180, "type": "default" }, ... ]
  listImages Json
}
model OverseasShippingSettings {
  id            Int         @id @default(autoincrement())
  basicPolicyId Int         @unique
  basicPolicy   BasicPolicy @relation(fields: [basicPolicyId], references: [id])

  // 각 몰(국가)별 배송 조건 (JSON)
  // {
  //   "en_US": { "rateStandard": "ems", "useInsurance": false, "boxWeight": 0.0 },
  //   "zh_CN": { ... },
  //   "ja_JP": { ... }
  // }
  conditions Json
}

// 1. 부가세율 설정 (VAT Settings)
model VatSettings {
  id             Int         @id @default(autoincrement())
  basicPolicyId  Int         @unique
  basicPolicy    BasicPolicy @relation(fields: [basicPolicyId], references: [id])

  productVatRate  Decimal @default(10.0) // 상품 부가세율 (10 or 0)
  shippingVatRate Decimal @default(10.0) // 배송비 부가세율 (10 or 0)

  // 커스텀 세율 리스트 (JSON)
  // 예: [{ "id": 123, "value": "5" }, ...]
  customProductRates  Json?
  customShippingRates Json?
}

// 2. 이용/탈퇴 안내 (Guide Settings)
model GuideSettings {
  id             Int         @id @default(autoincrement())
  basicPolicyId  Int         @unique
  basicPolicy    BasicPolicy @relation(fields: [basicPolicyId], references: [id])

  // 국가별 이용안내 (JSON)
  // 예: { "kr": "내용...", "cn": "内容..." }
  usageGuide      Json
  
  // 국가별 탈퇴안내 (JSON)
  withdrawalGuide Json
}

// 3. 금액/단위 기준 설정 (Currency/Unit Settings)
model CurrencySettings {
  id             Int         @id @default(autoincrement())
  basicPolicyId  Int         @unique
  basicPolicy    BasicPolicy @relation(fields: [basicPolicyId], references: [id])

  baseCountry     String @default("kr") // 기준 국가 (kr, cn, us, jp)
  currencyDisplay String @default("won") // 금액 표시 방법 (won, symbol, won_symbol)
  weightUnit      String @default("g")   // 무게 단위 (g, kg)
}

// 4. 저장소 경로 일괄 관리 (Storage Settings)
model StorageSettings {
  id             Int         @id @default(autoincrement())
  basicPolicyId  Int         @unique
  basicPolicy    BasicPolicy @relation(fields: [basicPolicyId], references: [id])

  // 저장소 경로 맵 (JSON)
  // 예: { "productImage": "/path/to/img", ... }
  storagePaths Json
  
  // 파일 경로 맵 (JSON)
  filePaths    Json
}

// 5. 검색엔진 최적화(SEO) 설정 (SEO Settings)
model SeoSettings {
  id             Int         @id @default(autoincrement())
  basicPolicyId  Int         @unique
  basicPolicy    BasicPolicy @relation(fields: [basicPolicyId], references: [id])

  // --- 검색로봇 정보수집 설정 ---
  pcRobotTxt      String? @db.Text // PC robots.txt Content
  mobileRobotTxt  String? @db.Text // Mobile robots.txt Content

  // --- 주요 페이지 SEO 태그 설정 (JSON) ---
  // 탭별(common, product, etc) 메타태그 정보 저장
  // 예: { "common": { "title": "...", "author": "..." }, "product": { ... } }
  majorPageTags   Json?

  // --- 오픈그래프/X 메타태그 기본설정 ---
  ogImage        String?
  ogTitle        String?
  ogDescription  String?

  // --- 사이트맵 설정 ---
  sitemapPath    String?

  // --- RSS 설정 ---
  rssPath        String?

  // --- 페이지 경로 설정 ---
  // error: 오류 페이지, custom: 설정한 경로
  pagePathType   String @default("error") 
  pagePathUrl    String? // 설정한 경로 URL

  // --- 대표 URL(Canonical URL) 설정 ---
  useCanonical   Boolean @default(false)

  // --- 연관채널 설정 (JSON List) ---
  // ["https://facebook.com/...", ...]
  relatedChannels Json?

  // --- 기타 페이지 SEO 태그 설정 (JSON List) ---
  // [{ "path": "/event", "title": "..." }, ...]
  otherPageTags   Json?
}

// 6. 환율 설정 (Exchange Rate Settings)
model ExchangeRateSettings {
  id            Int         @id @default(autoincrement())
  basicPolicyId Int         @unique
  basicPolicy   BasicPolicy @relation(fields: [basicPolicyId], references: [id])

  // 환율 정보 (JSON)
  rates Json
}



// 17. 구글 로그인 설정 (Google Login Settings)
model GoogleLoginSettings {
  id              Int         @id @default(autoincrement())

  basicPolicyId   Int         @unique
  basicPolicy     BasicPolicy @relation(fields: [basicPolicyId], references: [id])

  // 사용설정 (used, unused)
  usage           String      @default("unused")

  // Client ID
  clientId        String      @default("")

  // Client Secret
  clientSecret    String      @default("")
}

// 18. 상품 상세 노출항목 설정 (Product Detail Exposure Settings)
model ProductDetailExposureSettings {
  id              Int         @id @default(autoincrement())

  basicPolicyId   Int         @unique
  basicPolicy     BasicPolicy @relation(fields: [basicPolicyId], references: [id])

  isMobileSame    Boolean     @default(true) // 모바일 쇼핑몰 동일 적용
  
  // PC 노출항목 (JSON Array of string)
  pcExposureItems Json
  
  // 모바일 노출항목 (JSON Array of string)
  mobileExposureItems Json
  
  // 할인적용가 설정 (JSON) - { productDiscount: boolean, couponDiscount: boolean }
  discountSettings Json
  
  // 노출항목 추가 설정 (JSON) - { optionStock: boolean, icon: boolean, representativeColor: boolean, discountRate: boolean }
  additionalSettings Json
  
  // 취소선 추가 설정 (JSON) - { consumerPrice: boolean, salePrice: boolean }
  strikeSettings Json

  updatedAt       DateTime    @updatedAt
}

// 19. 회원 가입 정책 (Member Join Policy)
model MemberJoinPolicy {
  id            Int         @id @default(autoincrement())
  basicPolicyId Int         @unique
  basicPolicy   BasicPolicy @relation(fields: [basicPolicyId], references: [id])

  // 가입승인 사용설정: none(승인절차없음), all(승인후가입), business(사업자만승인)
  approvalMethod String @default("none")

  // 가입연령제한 설정: none(제한안함), limit(제한)
  ageLimitMethod String @default("none")
  // '만 14세 이상입니다.' 동의 항목 사용
  useAgeConsent  Boolean @default(false)
  // 만 X세 미만인 경우
  underageAge    Int     @default(14)
  // 미만인 경우 처리: approval(운영자승인), ban(가입불가)
  underageAction String  @default("approval")

  // 본인인증 제외설정: use(사용함), exclude(제외함)
  simpleLoginAuthMethod String @default("use")

  // 재가입 기간제한: unused(사용안함), limit(기간제한)
  rejoinLimitMethod String @default("unused")
  rejoinLimitDays   Int    @default(0)

  // 가입불가 회원아이디
  fraudulentIds     String @db.Text @default("admin,administration,administrator,master,webmaster,manage,manager,godo,godomall")
}

// 21. 회원 등급 설정 (Member Grade Settings)
model MemberGradeSettings {
  id            Int         @id @default(autoincrement())
  basicPolicyId Int         @unique
  basicPolicy   BasicPolicy @relation(fields: [basicPolicyId], references: [id])

  // 쇼핑몰페이지 노출이름
  gradeDisplayName String @default("등급")

  // 쿠폰 발급 시점 설정
  // 회원등급 평가 완료 시 발급
  couponEvalDone    Boolean @default(false)
  // 등급 변경 시에만 발급 (evalDone이 true일 때 유효)
  couponGradeChangeOnly Boolean @default(false)

  // 회원등급을 직접 수정 시 발급
  couponManualEdit  Boolean @default(false)

  // 회원 엑셀 업로드로 회원등급 업데이트 시 발급
  couponExcelUpdate Boolean @default(false)
  // 등급 변경 시에만 발급 (excelUpdate가 true일 때 유효)
  couponExcelChangeOnly Boolean @default(false)

  // --- 평가 방법 설정 ---
  evaluationMethod   String @default("auto") // auto, manual
  downgradeUsage     String @default("use")  // use, unused
  criteriaMethod     String @default("figures") // figures, score

  // 등급 산정 기간 (개월)
  inputPeriod        Int    @default(0)
  
  // 등급 개수 (자동산출 등에서 사용)
  gradeCount         Int    @default(0)

  // 실적 점수제 설정 (JSON)
  // {
  //   orderAmount: { used: true, unit: 10000, point: 100 },
  //   mobileOrderAmount: { unit: 10000, point: 50 },
  //   orderCount: { used: true, point: 10 },
  //   reviewCount: { used: true, point: 5 },
  //   loginCount: { used: true, point: 1 }
  // }
  scoreSettings      Json?
}

// 22. 쇼핑몰/회사 기본 정보 (Basic Info Settings)
model BasicInfoSettings {
  id              Int         @id @default(autoincrement())

  basicPolicyId   Int         @unique
  basicPolicy     BasicPolicy @relation(fields: [basicPolicyId], references: [id])

  // --- 쇼핑몰 기본 정보 ---
  shopName        String      @default("엔큐버스")
  shopNameEng     String      @default("nKubus")
  topTitle        String      @default("nKubus")
  faviconPath     String      @default("")
  domain          String      @default("sosexy7654.godomall.com")
  repCategory     String      @default("구매대행")

  // --- 회사 정보 ---
  companyName     String      @default("니아인터내셔널")
  bizLicenseNum   String      @default("291-81-0245")
  ceoName         String      @default("윤지현")
  bizCondition    String      @default("도소매") // 업태
  bizItem         String      @default("전자상거래") // 종목
  
  repEmail        String      @default("sosexy76@naver.com") // 대표 이메일
  
  // 사업장 주소
  zipCode         String      @default("06136")
  address         String      @default("서울특별시 강남구 논현로102길 5(역삼동)")
  addressDetail   String      @default("4층")
  
  // 출고지 주소
  shipZipCode     String      @default("")
  shipAddress     String      @default("")
  shipAddrDetail  String      @default("")
  
  // 반품/교환지 주소
  returnZipCode    String     @default("")
  returnAddress    String     @default("")
  returnAddrDetail String     @default("")

  repPhone        String      @default("01071296105")
  fax             String      @default("")
  
  onlineSalesLicense String   @default("2022-서울 강남-0") // 통신판매신고번호
  
  sealImagePath   String      @default("")
  
  // 현금영수증 로고 (shop, required, direct, none)
  cashReceiptLogoType String  @default("none")
  
  // --- 고객센터 ---
  csPhone         String      @default("")
  csEmail         String      @default("sosexy76@naver.com")
  operatingHours  String      @db.Text // Textarea
  
  // --- 회사소개 ---
  companyIntro    String      @db.Text // HTML content
}

// 23. 해외 상점 설정 (Global Shop Settings)
model GlobalShopSettings {
  id            Int         @id @default(autoincrement())
  basicPolicyId Int         @unique
  basicPolicy   BasicPolicy @relation(fields: [basicPolicyId], references: [id])

  // 국가별 설정 (JSON Key: Country Code)
  // {
  //   "us": {
  //     "usage": "unused",
  //     "domain": "...",
  //     "connectDomain": "...",
  //     "currency": { "display": "dollar", "decimals": "2decimals" },
  //     "referenceCurrency": "unused",
  //     "priorityRegion": "usa",
  //     "skin": { "pc": "english-default", "mobile": "english-default" }
  //   },
  //   ...
  // }
  settings Json
}

// 24. 주문서 추가정보 설정 (Order Additional Info Settings)
model OrderAdditionalInfoSettings {
  id            Int         @id @default(autoincrement())
  basicPolicyId Int         @unique
  basicPolicy   BasicPolicy @relation(fields: [basicPolicyId], references: [id])

  // 국가별 사용 여부 (JSON Key: Country Code)
  // { "kr": "used", "cn": "unused" }
  usageSettings Json

  // 추가정보 항목 리스트 (JSON Array)
  // [
  //   {
  //     "id": "uuid",
  //     "mallId": "kr",
  //     "order": 1,
  //     "display": true,
  //     "required": false,
  //     "name": "...",
  //     "type": "text", // text, select, radio, etc.
  //     "detailSettings": { ... },
  //     "condition": { ... },
  //     "exception": { ... }
  //   }
  // ]
  items Json
}
